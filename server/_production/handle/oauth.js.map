{"version":3,"sources":["../../app/handle/oauth.js"],"names":[],"mappings":";;AAQA;;;;AACA;;;;AACA;;AACA;;;;;;;;;;;;AAEA,IAAM,OAAO,uBAAb;;AAEA,QAAQ,YAAR,GAAuB,UAAC,GAAD,EAAM,GAAN,EAAW,CAAX,EAAiB;AACtC,MAAM,QAAQ,wBAAY,EAAE,KAAd,CAAd;AACA,MAAM,OAAO;AACX,gBAAY,MAAM,WADP;AAEX,SAAK,MAAM,QAFA;AAGX,QAAI,EAAE,EAHK;AAIX,UAAM,EAAE,KAAF,IAAW,EAJN;AAKX,gBAAY,EAAE,UAAF,IAAgB,EALjB;AAMX,cAAU,EAAE,QAAF,IAAc,EANb;AAOX,UAAM,EAAE,IAAF,IAAU,EAPL;AAQX,cAAU,EAAE,QAAF,IAAc,EARb;AASX,WAAO,EAAE,KAAF,IAAW,EATP;AAUX,gBAAY,EAAE,UAAF,IAAgB,EAVjB;AAWX,gBAAY,EAAE,UAAF,IAAgB;AAXjB,GAAb;;AAcA,OAAK,IAAL,CAAU,EAAC,IAAI,EAAE,EAAP,EAAV,EAAsB,UAAC,GAAD,EAAM,IAAN,EAAe;AACnC,QAAM,QAAQ;AACZ,cAAQ,aADI;AAEZ,cAAQ,UAFI;AAGZ,gBAAU,KAHE;AAIZ,cAAQ,KAJI;AAKZ,YAAM;AALM,KAAd;;AAQA,QAAG,QAAQ,KAAK,MAAL,IAAe,CAA1B,EAA6B;AAC3B,UAAM,OAAO,IAAI,IAAJ,CAAS,IAAT,CAAb;;AAEA,WAAK,IAAL,CAAU,UAAC,GAAD,EAAM,IAAN,EAAe;AACvB,YAAI,MAAJ,CAAW,MAAX,EAAmB,MAAM,QAAzB,EAAmC,KAAnC;AACA,YAAI,QAAJ,CAAa,QAAb;AACD,OAHD;AAID,KAPD,MAOM;AACJ,UAAI,MAAJ,CAAW,MAAX,EAAmB,MAAM,QAAzB,EAAmC,KAAnC;AACA,UAAI,QAAJ,CAAa,QAAb;AACD;AACF,GApBD;AAqBD,CArCD;;AAuCA,QAAQ,YAAR,GAAuB,UAAC,GAAD,EAAM,GAAN,EAAc;AACnC,MAAM,SAAS,IAAI,OAAJ,CAAY,MAAZ,CAAf;;AAEA,OAAK,IAAL,CAAU,EAAC,KAAK,MAAN,EAAV,EAAyB,UAAC,GAAD,EAAM,IAAN,EAAe;AACtC,0BAAU,GAAV,EAAe,EAAC,MAAM,IAAP,EAAa,MAAM,IAAnB,EAAf;AACD,GAFD;AAGD,CAND","file":"oauth.js","sourcesContent":["/*\n* @Author: woolson\n* @Date:   2016-12-16 16:34:11\n* @Email:   woolson.lee@gmail.com\n* @Last modified by:   woolson\n* @Last modified time: 2017-01-16 16:01:76\n*/\n\nimport mongoose from \"mongoose\"\nimport path from \"path\"\nimport { usersDB } from \"../db/mongodb\"\nimport { getNameHash, jsonWrite } from \"../global/utils\"\n\nconst User = usersDB()\n\nexports.insertGithub = (req, res, d) => {\n  const hashs = getNameHash(d.login)\n  const data = {\n    session_id: hashs.sessionHash,\n    uid: hashs.nameHash,\n    id: d.id,\n    name: d.login || \"\",\n    avatar_url: d.avatar_url || \"\",\n    html_url: d.html_url || \"\",\n    blog: d.blog || \"\",\n    location: d.location || \"\",\n    email: d.email || \"\",\n    created_at: d.created_at || \"\",\n    updated_at: d.updated_at || \"\"\n  }\n\n  User.find({id: d.id}, (err, docs) => {\n    const param = {\n      domain: \".woolson.cn\",\n      maxAge: 5184000000,\n      httpOnly: false,\n      secure: false,\n      path: \"/\",\n    }\n\n    if(docs && docs.length == 0) {\n      const user = new User(data)\n\n      user.save((err, docs) => {\n        res.cookie(\"user\", hashs.nameHash, param)\n        res.redirect(\"/study\")\n      })\n    }else {\n      res.cookie(\"user\", hashs.nameHash, param)\n      res.redirect(\"/study\")\n    }\n  })\n}\n\nexports.getLoginUser = (req, res) => {\n  const userID = req.cookies[\"user\"]\n\n  User.find({uid: userID}, (err, docs) => {\n    jsonWrite(res, {succ: true, user: docs})\n  })\n}\n"]}
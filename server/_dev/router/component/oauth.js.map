{"version":3,"sources":["../../../app/router/component/oauth.js"],"names":[],"mappings":";;;;;;AAOA;;;;AACA;;AACA;;;;kBAEe,eAAO;AACpB,MAAI,GAAJ,CAAQ,eAAR,EAAyB,UAAC,GAAD,EAAM,GAAN,EAAc;AACrC,QAAM,QAAQ;AACZ,WAAK,6CADO;AAEZ,iBAAW,sBAFC;AAGZ,qBAAe,0CAHH;AAIZ,YAAM,IAAI,KAAJ,CAAU;AAJJ,KAAd;;AAQA,QAAM,OAAO;AACX,WAAK,+BAAmB,KAAnB,CADM;AAEX,eAAS;AACP,gBAAQ;AADD;AAFE,KAAb;;AAOA,2BAAQ,IAAR,EAAc,UAAC,GAAD,EAAM,QAAN,EAAgB,IAAhB,EAAyB;AACrC,aAAO,KAAK,KAAL,CAAW,IAAX,CAAP;AACA,UAAG,KAAK,YAAR,EAAsB;AACpB,YAAM,SAAQ;AACZ,eAAK,8CAA8C,KAAK,YAD5C;AAEZ,mBAAS;AACP,oBAAQ,kBADD;AAEP,0BAAc;AAFP;AAFG,SAAd;AAOA,+BAAQ,MAAR,EAAe,UAAC,GAAD,EAAM,QAAN,EAAgB,IAAhB,EAAyB;AACtC,iBAAO,KAAK,KAAL,CAAW,IAAX,CAAP;AACA,cAAG,CAAC,KAAK,OAAT,EAAkB,yBAAa,GAAb,EAAkB,GAAlB,EAAuB,IAAvB,EAAlB,KACK,IAAI,QAAJ,CAAa,QAAb;AACN,SAJD;AAKD,OAbD,MAaM,IAAI,QAAJ,CAAa,GAAb;AACP,KAhBD;AAiBD,GAjCD;;AAmCA,MAAI,GAAJ,CAAQ,cAAR,EAAwB,UAAC,GAAD,EAAM,GAAN,EAAc;AACpC,QAAM,SAAS,IAAI,OAAJ,CAAY,IAA3B;AACA,QAAG,MAAH,EAAW,yBAAa,GAAb,EAAkB,GAAlB,EAAX,KACK,sBAAU,GAAV;AACN,GAJD;AAKD,C","file":"oauth.js","sourcesContent":["/*\n* @Author: woolson\n* @Date:   2016-12-16 00:31:52\n* @Email:   woolson.lee@gmail.com\n* @Last modified by:   woolson\n* @Last modified time: 2017-01-06 22:01:28\n*/\nimport request from \"request\"\nimport { fetchUrlwithParams, getParamFromStr, jsonWrite, isEmpty } from \"../../global/utils\"\nimport { insertGithub, getLoginUser } from \"../../handle/oauth\"\n\nexport default app => {\n  app.get(\"/oauth/github\", (req, res) => {\n    const param = {\n      url: \"https://github.com/login/oauth/access_token\",\n      client_id: \"72e5cae736efb0366ffc\",\n      client_secret: \"3a1efa6bdab27ec200828acacbe4ee83a6937026\",\n      code: req.query.code,\n      // redirect_uri: \"http://woolson.cn/oauth/github/accessed\"\n    }\n\n    const data = {\n      url: fetchUrlwithParams(param),\n      headers: {\n        Accept: \"application/json\",\n      }\n    }\n\n    request(data, (err, response, body) => {\n      body = JSON.parse(body)\n      if(body.access_token) {\n        const param = {\n          url: \"https://api.github.com/user?access_token=\" + body.access_token,\n          headers: {\n            Accept: \"application/json\",\n            \"User-Agent\": \"woolson's website\",\n          }\n        }\n        request(param, (err, response, body) => {\n          body = JSON.parse(body)\n          if(!body.message) insertGithub(req, res, body)\n          else res.redirect(\"/study\")\n        })\n      }else res.redirect(\"/\")\n    })\n  })\n\n  app.get(\"/oauth/login\", (req, res) => {\n    const userID = req.cookies.user\n    if(userID) getLoginUser(req, res)\n    else jsonWrite(res)\n  })\n}\n"]}